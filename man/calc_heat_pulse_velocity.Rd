% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03a_heat_pulse_velocity_core.R
\name{calc_heat_pulse_velocity}
\alias{calc_heat_pulse_velocity}
\title{Calculate Heat Pulse Velocity}
\usage{
calc_heat_pulse_velocity(
  sap_data,
  pulse_ids = NULL,
  methods = c("HRM", "MHR", "DMA"),
  probe_config = NULL,
  wood_properties = NULL,
  parameters = NULL,
  diffusivity = NULL,
  probe_spacing = NULL,
  probe_corrections = NULL,
  plot_results = FALSE,
  show_progress = TRUE
)
}
\arguments{
\item{sap_data}{A sap_data object from read_sap_data()}

\item{pulse_ids}{Vector of pulse IDs to process. If NULL, processes all pulses.}

\item{methods}{Character vector of methods to use. Options: "HRM", "MHR", "HRMXa", "HRMXb",
"Tmax_Coh", "Tmax_Klu", "DMA". Default: c("HRM", "MHR", "DMA")}

\item{probe_config}{Probe configuration. Can be: ProbeConfiguration object, config name (e.g., "symmetrical"),
path to custom YAML, or NULL (uses default symmetric config)}

\item{wood_properties}{Wood properties. Can be: WoodProperties object, config name (e.g., "eucalyptus"),
path to custom YAML, or NULL (uses default generic softwood)}

\item{parameters}{List of calculation parameters. See details.}

\item{diffusivity}{Thermal diffusivity override (cm²/s). If provided, overrides wood_properties value.}

\item{probe_spacing}{Probe spacing override (cm). If provided, overrides probe_config value.}

\item{probe_corrections}{Optional output from apply_hpv_corrections(). If provided, corrections
metadata will be attached to results. Note: This function calculates raw Vh; apply corrections
afterwards using apply_hpv_corrections().}

\item{plot_results}{Logical indicating whether to generate diagnostic plots}

\item{show_progress}{Logical indicating whether to report progress (default: TRUE)}
}
\value{
A tibble containing calculated heat pulse velocities with columns:
\item{datetime}{Timestamp of measurement}
\item{pulse_id}{Pulse identification number}
\item{method}{Calculation method used}
\item{sensor_position}{Inner or outer sensor position}
\item{Vh_cm_hr}{Heat pulse velocity in cm/hr}
\item{quality_flag}{Data quality indicator}
}
\description{
Calculates heat pulse velocity (Vh) from sap flow temperature data using multiple methods
including Heat Ratio Method (HRM), Maximum Heat Ratio (MHR), T-max methods, and others.
}
\details{
Progress reporting works through the \code{progressr} package. Wrap calls in
\code{progressr::with_progress({})} to see progress bars. Works in both console and Shiny.

The parameters list should contain:
\describe{
\item{diffusivity}{Thermal diffusivity of sapwood (cm²/s), default: 0.0025}
\item{probe_spacing}{Distance from heat source (cm), default: 0.5}
\item{L}{Lower proportion of deltaTmax for HRMX sampling window, default: 0.5}
\item{H}{Higher proportion of deltaTmax for HRMX sampling window, default: 0.8}
\item{tp_1}{Heat pulse duration (sec) for Tmax_Klu, default: 2}
\item{HRM_start}{Start of sampling window for HRM (sec after pulse), default: 60}
\item{HRM_end}{End of sampling window for HRM (sec after pulse), default: 100}
\item{pre_pulse}{Pre-pulse period (sec), default: 30}
}
}
\examples{
\dontrun{
# Load data and calculate velocities with progress bars
sap_data <- read_sap_data("data.txt")
progressr::with_progress({
  results <- calc_heat_pulse_velocity(sap_data)
})

# Use specific methods and parameters
params <- list(diffusivity = 0.003, probe_spacing = 0.6)
progressr::with_progress({
  results <- calc_heat_pulse_velocity(sap_data, methods = c("HRM", "MHR"),
                                     parameters = params)
})
}

}
\references{
\itemize{
\item Burgess et al. (2001) Tree Physiology 21:589-598 (HRM)
\item Lopez et al. (2021) Plant Soil 469:503-523 (MHR)
\item Cohen et al. (1981) Plant, Cell and Environment 4:391-397 (Tmax_Coh)
\item Kluitenberg & Ham (2004) Ag For Met 126:169-173 (Tmax_Klu)
}
}
